"use strict";const input=document.querySelector("#search"),button=document.querySelector(".btn"),results=document.querySelector(".results"),favorites=document.querySelector(".favorites"),api="http://api.tvmaze.com/search/shows?q=",savedFavorites=JSON.parse(localStorage.getItem("favorites"));let savedFavoritesList=[savedFavorites],favoritesList=[];const printFavorites=e=>{favorites.innerHTML="";for(let t=0;t<e.length;t++){const s=e[t],a=document.createElement("li");a.classList.add("fave"),a.setAttribute("data-id",t);const i=document.createElement("h3");i.classList.add("fave-title");const r=document.createTextNode(s.title),o=document.createElement("img");o.classList.add("fave-image"),o.setAttribute("src",s.image),o.setAttribute("alt",s.title);const n=document.createElement("img");n.classList.add("delete"),n.setAttribute("src","../assets/images/delete.png"),n.addEventListener("click",deleteHandler),i.appendChild(r),a.appendChild(o),a.appendChild(i),a.appendChild(n),favorites.appendChild(a)}},checkFavorites=()=>{if(savedFavorites)return console.log("saved favorites",savedFavorites),printFavorites(savedFavoritesList[0]),savedFavoritesList;{console.log("no favorites!");const e=document.createElement("li");e.classList.add("favorites-message");const t=document.createTextNode("No hay favoritos! AÃ±adirlos hacer clic en una serie...");e.appendChild(t),favorites.appendChild(e)}};checkFavorites();const showSeries=(e,t)=>{e.innerHTML="";for(let s=0;s<t.length;s++){const a=t[s],i=document.createElement("li");i.classList.add("results-card"),i.setAttribute("data-id",s);const r=document.createElement("h2");r.classList.add("results-title");const o=document.createTextNode(a.name),n=document.createElement("img");n.classList.add("results-image"),n.style="height: 200px",n.setAttribute("alt",a.name),a.image?n.setAttribute("src",a.image):n.setAttribute("src","https://via.placeholder.com/210x295/ffffff/666666/?text=TV"),r.appendChild(o),i.appendChild(r),i.appendChild(n),i.addEventListener("click",favoritesHandler),e.appendChild(i)}},favoritesHandler=()=>{makeFavorites(event,savedFavorites?savedFavoritesList[0]:favoritesList)},saveFavorites=e=>{localStorage.setItem("favorites",JSON.stringify(e))},makeFavorites=(e,t)=>{const s=e.currentTarget;s.classList.toggle("favorite");const a=parseInt(s.dataset.id);if(s.classList.contains("favorite")){const e={id:a,title:s.childNodes[0].innerHTML,image:s.childNodes[1].src};t.push(e)}printFavorites(t),saveFavorites(t)},getSeries=()=>{const e=input.value,t=[];fetch(`${api}${e}`).then(e=>e.json()).then(e=>{if(e.length>0){for(let s=0;s<e.length;s++){const a=e[s].show,i={};i.name=a.name,null!==a.image&&(i.image=a.image.original),t.push(i)}showSeries(results,t)}else{const e=document.createElement("li");e.classList.add("results-message");const t=document.createTextNode("No hay resultados! Intenta otra vez :)");e.appendChild(t),results.appendChild(e)}})};function deleteHandler(){deleteFave(event)}function deleteFave(e){const t=parseInt(e.currentTarget.parentElement.dataset.id);console.log(t);savedFavorites.splice(t,1);console.log(savedFavorites),printFavorites(savedFavorites),saveFavorites(savedFavorites)}button.addEventListener("click",getSeries),input.addEventListener("keyup",function(e){13===e.keyCode&&getSeries()});